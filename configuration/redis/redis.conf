# Redis конфигурация для Docker

# Слушать все интерфейсы (необходимо для Docker networking)
bind 0.0.0.0

# Порт подключения
port 6379

# Режим protected-mode
protected-mode yes

# Требование пароля для аутентификации
requirepass redis_password

# Логирование
loglevel notice
logfile "/data/redis.log"

# ========== PERSISTENCE - RDB (снимки) ==========
# Сохранить если изменилось 1 ключ за 900 секунд
save 900 1
# Сохранить если изменилось 10 ключей за 300 секунд
save 300 10
# Сохранить если изменилось 10000 ключей за 60 секунд
save 60 10000

# Остановить запись RDB если произошла ошибка
stop-writes-on-bgsave-error yes

# Сжимать RDB файл
rdbcompression yes

# Имя RDB файла
dbfilename dump.rdb

# Директория для RDB файлов
dir /data

# ========== PERSISTENCE - AOF (Append Only File) ==========
appendonly yes
appendfilename "appendonly.aof"
# Синхронизировать после каждой команды (медленнее но безопаснее)
appendfsync everysec

# ========== ДРУГИЕ ПАРАМЕТРЫ ==========
# Количество баз данных
databases 16

# Максимальное количество клиентов
maxclients 10000

# Таймауты
timeout 0
tcp-keepalive 300
