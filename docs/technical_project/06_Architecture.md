### Контекстная диаграмма архитектуры решения

[![Контекстная диаграмма Платформы](../images/ContextDiagram.png)](../images/ContextDiagram.png)

Платформа принимает запросы от пользователей, а при необходимости проведения оплаты выполняется обращение к внешнему платёжному сервису, действующему в российской юрисдикции. 
Администратор также обращается к Платформе для загрузки данных (“*красных флажков*”), которые предварительно составили юристы.

### Диаграмма контейнеров архитектуры решения

[![Диаграмма контейнеров Платформы](../images/ContainerDiagram.png)](../images/ContainerDiagram.png)

Администратор взаимодействует с Платформой через Jupyter-notebook, развёрнутый на выделенном сервере. Клиент Jupyter-notebook располагается локально на рабочем месте Администратора. Тем самым Администратор выполняет загрузку “красных флажков” в `Flags Parser Service`, откуда они попадают в векторное хранилище в виде эмбеддингов.

Взаимодействие Пользователей с Платформой осуществляется через тг-бот. Дальнейшее взаимодействие бота происходит через оркестратор n8n, который выполняет функциональное связывание всех компонентов Платформы, включая взаимодействие с внешним платёжным сервисом через Payment_Service. 
После загрузки документа в `Client Document Parser` происходит очистка документов от избыточных для дальнейшего анализа артефактов (колонтитулы, оглавление и т.д.). Все действия Пользователя фиксируются в реляционной СУБД `PostgreSQL`, полученные после очистки и чанкинга эмбеддинги размещаются в `Client Document Parser`, а загруженные документы в хранилище `MinIO` для выполнения [ФТ-24](https://github.com/trofimovelijah/red-flag-analysis/issues/45). В ходе анализа выполняется сравнение эмбеддингов из векторного хранилища и обработка результата с помощью LLM.
При необходимости Пользователь может через `Сервис оплаты` обратиться к внешнему платёжному сервису для снятия лимитов на бесплатном тарифном плане. 

